Ext.namespace("MODx.util.Progress");MODx.util.JSONReader=function(A){A=A||{};Ext.applyIf(A,{successProperty:"success",totalProperty:"total",root:"data"});MODx.util.JSONReader.superclass.constructor.call(this,A,["id","msg"]);};Ext.extend(MODx.util.JSONReader,Ext.data.JsonReader);Ext.reg("modx-json-reader",MODx.util.JSONReader);MODx.util.Progress={id:0,time:function(A,C,B){B=B||_("saving");if(MODx.util.Progress.id===C&&A<11){Ext.MessageBox.updateProgress(A/10,B);}},reset:function(){MODx.util.Progress.id=MODx.util.Progress.id+1;}};MODx.LockMask=function(A){A=A||{};Ext.applyIf(A,{msg:_("locked"),msgCls:"modx-lockmask"});MODx.LockMask.superclass.constructor.call(this,A.el,A);};Ext.extend(MODx.LockMask,Ext.LoadMask,{locked:false,toggle:function(){if(this.locked){this.hide();this.locked=false;}else{this.show();this.locked=true;}},lock:function(){this.locked=true;this.show();},unlock:function(){this.locked=false;this.hide();}});Ext.reg("modx-lockmask",MODx.LockMask);Ext.override(Ext.form.BasicForm,{clearDirty:function(A){A=A||this;A.items.each(function(B){if(!B.getValue){return ;}if(B.items){this.clearDirty(B);}else{if(B.originalValue!=B.getValue()){B.originalValue=B.getValue();}}},this);}});MODx.StaticTextField=Ext.extend(Ext.form.TextField,{fieldClass:"x-static-text-field",onRender:function(){this.readOnly=true;this.disabled=!this.initialConfig.submitValue;MODx.StaticTextField.superclass.onRender.apply(this,arguments);}});Ext.reg("statictextfield",MODx.StaticTextField);MODx.StaticBoolean=Ext.extend(Ext.form.TextField,{fieldClass:"x-static-text-field",onRender:function(A){this.readOnly=true;this.disabled=!this.initialConfig.submitValue;MODx.StaticBoolean.superclass.onRender.apply(this,arguments);this.on("change",this.onChange,this);},setValue:function(A){if(A===1){this.addClass("green");A=_("yes");}else{this.addClass("red");A=_("no");}MODx.StaticBoolean.superclass.setValue.apply(this,arguments);}});Ext.reg("staticboolean",MODx.StaticBoolean);Ext.override(Ext.form.Checkbox,{setBoxLabel:function(A){this.boxLabel=A;if(this.rendered){this.wrap.child(".x-form-cb-label").update(A);}}});Array.prototype.in_array=function(A){for(var C=0,B=this.length;C<B;C=C+1){if(this[C]===A){return true;}}return false;};Ext.form.setCheckboxValues=function(B,E,A){var C,D=0;while((C=B.findField(E+D))!==null){C.setValue((A&(1<<D))?"true":"false");D=D+1;}};Ext.form.getCheckboxMask=function(D){var B="";if(typeof (D)!=="undefined"){if((typeof (D)==="string")){B=D+"";}else{for(var C=0,A=D.length;C<A;C=C+1){B+=(B!==""?",":"")+(D[C]-0);}}}return B;};Ext.form.BasicForm.prototype.append=function(){var C=new Ext.form.Layout();var A=[];C.stack.push.apply(C.stack,arguments);for(var B=0;B<arguments.length;B=B+1){if(arguments[B].isFormField){A.push(arguments[B]);}}C.render(this.el);if(A.length>0){this.items.addAll(A);for(var D=0;D<A.length;D=D+1){A[D].render("x-form-el-"+A[D].id);}}return this;};Ext.form.AMPMField=function(B,A){return new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["ampm"],data:[["am"],["pm"]]}),displayField:"ampm",hiddenName:B,mode:"local",editable:false,forceSelection:true,triggerAction:"all",width:60,value:A||"am"});};Ext.form.HourField=function(C,B,A){return new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["hour"],data:[[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12]]}),displayField:"hour",mode:"local",triggerAction:"all",width:60,forceSelection:true,rowHeight:false,editable:false,value:A||1,transform:C});};Ext.override(Ext.tree.TreeNodeUI,{hasClass:function(B){var A=Ext.fly(this.elNode);if(!A){return"";}return B&&(" "+A.dom.className+" ").indexOf(" "+B+" ")!==-1;}});Ext.override(Ext.form.Action.Submit,{handleResponse:function(D){var B=Ext.decode(D.responseText);if(this.form.errorReader){var C=this.form.errorReader.read(D);var G=[];if(C.records){for(var E=0,A=C.records.length;E<A;E=E+1){var F=C.records[E];G[E]=F.data;}}if(G.length<1){G=null;}return{success:C.success,message:B.message,object:B.object,errors:G};}return Ext.decode(D.responseText);}});Ext.form.Field.prototype.afterRender=Ext.form.Field.prototype.afterRender.createSequence(function(){if(this.description){Ext.QuickTips.register({target:this.getEl(),text:this.description,enabled:true});var A=Ext.form.Field.findLabel(this);if(A){Ext.QuickTips.register({target:A,text:this.description,enabled:true});}}});Ext.applyIf(Ext.form.Field,{findLabel:function(C){var B=null;var A=null;B=C.getEl().up("div.x-form-element");if(B){A=B.child("label");}if(A){return A;}B=C.getEl().up("div.x-form-item");if(B){A=B.child("label");}if(A){return A;}}});MODx.util.Clipboard=function(){return{escape:function(A){A=encodeURIComponent(A);return A.replace(/%0A/g,"%0D%0A");},copy:function(C){if(Ext.isIE){window.clipboardData.setData("Text",C);}else{var B="flashcopier";if(!document.getElementById(B)){var D=document.createElement("div");D.id=B;document.body.appendChild(D);}document.getElementById(B).innerHTML="";var A='<embed src="'+MODx.config.manager_url+'assets/modext/_clipboard.swf" FlashVars="clipboard='+MODx.util.Clipboard.escape(C)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';document.getElementById(B).innerHTML=A;}}};}();Ext.util.Format.trimCommas=function(B){B=B.replace(",,",",");var A=B.length;if(B.substr(A-1,1)==","){B=B.substring(0,A-1);}if(B.substr(0,1)==","){B=B.substring(1);}if(B==","){B="";}return B;};Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(A){if("string"!==typeof A){return A;}return A.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1");};}Ext.ux.grid.RowActions=function(A){Ext.apply(this,A);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this);};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",editable:false,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visibility",widthIntercept:4,widthSlope:21,init:function(D){this.grid=D;this.id=this.id||Ext.id();var C=D.getColumnModel().lookup;delete (C[undefined]);C[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions);}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true;}var B=D.getView();var A={scope:this};A[this.actionEvent]=this.onClick;D.afterRender=D.afterRender.createSequence(function(){B.mainBody.on(A);D.on("destroy",this.purgeListeners,this);},this);if(!this.renderer){this.renderer=function(F,E,J,I,H,G){E.css+=(E.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(F,E,J,I,H,G));}.createDelegate(this);}if(B.groupTextTpl&&this.groupActions){B.interceptMouse=B.interceptMouse.createInterceptor(function(E){if(E.getTarget(".ux-grow-action-item")){return false;}});B.groupTextTpl='<div class="ux-grow-action-text">'+B.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply();}if(true===this.keepSelection){D.processEvent=D.processEvent.createInterceptor(function(E,F){if("mousedown"===E){return !this.getAction(F);}},this);}},getData:function(B,A,F,E,D,C){return F.data||{};},processActions:function(A,D){var C=[];Ext.each(A,function(E,F){if(E.iconCls&&"function"===typeof (E.callback||E.cb)){this.callbacks=this.callbacks||{};this.callbacks[E.iconCls]=E.callback||E.cb;}var G={cls:E.iconIndex?"{"+E.iconIndex+"}":(E.iconCls?E.iconCls:""),qtip:E.qtipIndex?"{"+E.qtipIndex+"}":(E.tooltip||E.qtip?E.tooltip||E.qtip:""),text:E.textIndex?"{"+E.textIndex+"}":(E.text?E.text:""),hide:E.hideIndex?'<tpl if="'+E.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(E.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:E.align||"right",style:E.style?E.style:""};C.push(G);},this);var B=new Ext.XTemplate(D||this.tplRow);return new Ext.XTemplate(B.apply({actions:C}));},getAction:function(C){var A=false;var B=C.getTarget(".ux-row-action-item");if(B){A=B.className.replace(/ux-row-action-item /,"");if(A){A=A.replace(/ ux-row-action-text/,"");A=A.trim();}}return A;},onClick:function(G,K){var J=this.grid.getView();var I=G.getTarget(".x-grid3-row");var H=J.findCellIndex(K.parentNode.parentNode);var F=this.getAction(G);if(false!==I&&false!==H&&false!==F){var E=this.grid.store.getAt(I.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[F]){this.callbacks[F](this.grid,E,F,I.rowIndex,H);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,E,F,I.rowIndex,H)){return ;}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,E,F,I.rowIndex,H);}}}t=G.getTarget(".ux-grow-action-item");if(t){var D=J.findGroup(K);var C=D?D.id.replace(/ext-gen[0-9]+-gp-/,""):null;var B;if(C){var A=new RegExp(RegExp.escape(C));B=this.grid.store.queryBy(function(L){return L._groupId.match(A);});B=B?B.items:[];}F=t.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[F]){this.callbacks[F](this.grid,B,F,C);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,B,F,C)){return false;}this.fireEvent("groupaction",this.grid,B,F,C);}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);Ext.SwitchButton=Ext.extend(Ext.Component,{initComponent:function(){Ext.SwitchButton.superclass.initComponent.call(this);var A=new Ext.util.MixedCollection();A.addAll(this.items);this.items=A;this.addEvents("change");if(this.handler){this.on("change",this.handler,this.scope||this);}},onRender:function(K,J){var I=document.createElement("table");I.cellSpacing=0;I.className="x-rbtn";I.id=this.id;var H=document.createElement("tr");I.appendChild(H);var G=this.items.length;var F=G-1;this.activeItem=this.items.get(this.activeItem);for(var C=0;C<G;C++){var E=this.items.itemAt(C);var D=H.appendChild(document.createElement("td"));D.id=this.id+"-rbi-"+C;var B=C===0?"x-rbtn-first":(C==F?"x-rbtn-last":"x-rbtn-item");E.baseCls=B;if(this.activeItem==E){B+="-active";}D.className=B;var A=document.createElement("button");A.innerHTML="&#160;";A.className=E.iconCls;A.title=E.tooltip;D.appendChild(A);E.cell=D;}this.el=Ext.get(K.dom.appendChild(I));this.el.on("click",this.onClick,this);},getActiveItem:function(){return this.activeItem;},setActiveItem:function(B){if(typeof B!="object"&&B!==null){B=this.items.get(B);}var A=this.getActiveItem();if(B!=A){if(A){Ext.fly(A.cell).removeClass(A.baseCls+"-active");}if(B){Ext.fly(B.cell).addClass(B.baseCls+"-active");}this.activeItem=B;this.fireEvent("change",this,B);}return B;},onClick:function(B){var A=B.getTarget("td",2);if(!this.disabled&&A){this.setActiveItem(parseInt(A.id.split("-rbi-")[1],10));}}});Ext.reg("switch",Ext.SwitchButton);Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(A){A.listClass="x-superboxselect-list";Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,A);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear");};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:""});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe);}}if(this.transform){this.doTransform();}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this});}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this);}},onRender:function(B,A){var C=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,B,A);this.hiddenName=C;this.manageNameAttribute();var D=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){D+=" x-superboxselect-display-btns";}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+D});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn();}this.setupFormInterception();},doTransform:function(){var K=Ext.getDom(this.transform),E=[];if(!this.store){this.mode="local";var G=[],A=K.options;for(var D=0,F=A.length;D<F;D++){var C=A[D],J=Ext.get(C),H=J.getAttributeNS(null,"value")||"",I=J.getAttributeNS(null,"className")||"",B=J.getAttributeNS(null,"style")||"";if(C.selected){E.push(H);}G.push([H,C.text,I,typeof (B)==="string"?B:B.cssText]);}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:G});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"});}if(E.length){this.value=E.join(",");}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});}this.initButtonEvents();return this;},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(A){A.stopEvent();if(this.disabled){return ;}this.clearValue();this.el.focus();},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(A){A.stopEvent();if(this.disabled){return ;}if(this.isExpanded()){this.multiSelectMode=false;}else{if(this.pinList){this.multiSelectMode=true;}}this.onTriggerClick();},this);}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners();}return this;},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null;}return this;},initEvents:function(){var A=this.el;A.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){A.focus();};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(B){if(this.fixFocusOnTabSelect&&this.isExpanded()){B.stopEvent();A.blur();this.onViewClick(false);this.focus(false,10);return true;}this.onViewClick(false);if(A.dom.value!==""){this.setRawValue("");}return true;},down:function(B){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick();}}else{this.inKeyMode=true;this.selectNext();}},enter:function(){}});},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize();},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var A=this.el.dom.value;if(A!==""){this.fireNewItemEvent(A);}}Ext.form.ComboBox.superclass.beforeBlur.call(this);},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this);},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize();}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this);},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false;},onWrapClick:function(A){A.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus();},markInvalid:function(C){var B,A;if(!this.rendered||this.preventMark){return ;}this.outerWrapEl.addClass(this.invalidClass);C=C||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:C,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:C,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable();}break;case"title":this.el.dom.title=C;this.wrapEl.dom.title=C;this.outerWrapEl.dom.title=C;break;case"under":if(!this.errorEl){B=this.getErrorCt();if(!B){this.el.dom.title=C;break;}this.errorEl=B.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(B.getWidth(true)-20);}this.errorEl.update(C);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){B=this.getErrorCt();if(!B){this.el.dom.title=C;break;}this.errorIcon=B.createChild({cls:"x-form-invalid-icon"});}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:C,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:A=Ext.getDom(this.msgTarget);A.innerHTML=C;A.style.display=this.msgDisplay;break;}this.fireEvent("invalid",this,C);},clearInvalid:function(){if(!this.rendered||this.preventMark){return ;}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this);}break;default:var A=Ext.getDom(this.msgTarget);A.innerHTML="";A.style.display="none";break;}this.fireEvent("valid",this);},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3]);}},expand:function(){if(this.isExpanded()||!this.hasFocus){return ;}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize;}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this);},restrictHeight:function(){var B=this.innerList.dom,C=B.scrollTop,F=this.list;B.style.height="";var G=F.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,D=Math.max(B.clientHeight,B.offsetHeight,B.scrollHeight),A=this.getPosition()[1]-Ext.getBody().getScroll().top,H=Ext.lib.Dom.getViewHeight()-A-this.getSize().height,E=Math.max(A,H,this.minHeight||0)-F.shadowOffset-G-5;D=Math.min(D,E,this.maxHeight);this.innerList.setHeight(D);F.beginUpdate();F.setHeight(D+G);F.alignTo(this.outerWrapEl,this.listAlign);F.endUpdate();if(this.multiSelectMode){B.scrollTop=C;}},validateValue:function(A){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}this.clearInvalid();return true;},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name);}else{this.el.dom.removeAttribute("name");}},setupFormInterception:function(){var A;this.findParentBy(function(C){if(C.getForm){A=C.getForm();}});if(A){var B=A.getValues;A.getValues=function(D){this.el.dom.disabled=true;var C=this.el.dom.value;this.setRawValue("");var E=B.call(A);this.el.dom.disabled=false;this.setRawValue(C);if(this.forceFormValue&&this.items.getCount()===0){E[this.name]="";}return D?Ext.urlEncode(E):E;}.createDelegate(this);}},onResize:function(A,C,E,B){var D=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=A;this.outerWrapEl.setWidth(A-D);if(this.renderFieldBtns){D+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(A-D);}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,A,C,E,B);this.autoSize();},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(A){A.enable();});if(this.renderFieldBtns){this.initButtonEvents();}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(A){A.disable();});if(this.renderFieldBtns){this.removeButtonEvents();}},clearValue:function(A){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=A||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this;},fireNewItemEvent:function(A){this.view.clearSelections();this.collapse();this.setRawValue("");if(this.queryFilterRe){A=A.replace(this.queryFilterRe,"");if(!A){return ;}}this.fireEvent("newitem",this,A,this.filteredQueryData);},onKeyUp:function(A){if(this.editable!==false&&(!A.isSpecialKey()||A.getKey()===A.BACKSPACE)&&this.itemDelimiterKey.indexOf!==A.getKey()&&(!A.hasModifier()||A.shiftKey)){this.lastKey=A.getKey();this.dqTask.delay(this.queryDelay);}},onKeyDownHandler:function(F,C){var B,H,A;if(F.getKey()===F.ESC){if(!this.isExpanded()){if(this.el.dom.value!=""&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value="";}if(this.clearLastQueryOnEscape){this.lastQuery="";}F.stopEvent();}}}if((F.getKey()===F.DELETE||F.getKey()===F.SPACE)&&this.currentFocus){F.stopEvent();B=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});A=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(A<(this.items.getCount()-1)){H=this.items.itemAt(A+1);}B.preDestroy(true);if(H){(function(){H.onLnkFocus();this.currentFocus=H;}).defer(200,this);}return true;}var G=this.el.dom.value,D,E=F.ctrlKey;if(this.itemDelimiterKey===F.getKey()){F.stopEvent();if(G!==""){if(E||!this.isExpanded()){this.fireNewItemEvent(G);}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}}else{if(!this.isExpanded()){return ;}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this);}}return true;}if(G!==""){this.autoSize();return ;}if(F.getKey()===F.HOME){F.stopEvent();if(this.items.getCount()>0){this.collapse();D=this.items.get(0);D.el.focus();}return true;}if(F.getKey()===F.BACKSPACE){F.stopEvent();if(this.currentFocus){B=this.currentFocus;this.on("expand",function(){this.collapse();},this,{single:true});A=this.items.indexOfKey(B.key);this.clearCurrentFocus();if(A<(this.items.getCount()-1)){H=this.items.itemAt(A+1);}B.preDestroy(true);if(H){(function(){H.onLnkFocus();this.currentFocus=H;}).defer(200,this);}return ;}else{D=this.items.get(this.items.getCount()-1);if(D){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse();},this,{single:true});D.preDestroy(true);}else{if(this.navigateItemsWithTab){D.onElClick();}else{this.on("expand",function(){this.collapse();this.currentFocus=D;this.currentFocus.onLnkFocus.defer(20,this.currentFocus);},this,{single:true});}}}return true;}}if(!F.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return ;}if(F.getKey()===F.LEFT||(F.getKey()===F.UP&&!this.isExpanded())){F.stopEvent();this.collapse();D=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(D){D.focus();}}else{if(this.currentFocus){A=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(A!==0){this.currentFocus=this.items.itemAt(A-1);this.currentFocus.onLnkFocus();}}else{this.currentFocus=D;if(D){D.onLnkFocus();}}}return true;}if(F.getKey()===F.DOWN){if(this.currentFocus){this.collapse();F.stopEvent();A=this.items.indexOfKey(this.currentFocus.key);if(A==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this);}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(A+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}return true;}}if(F.getKey()===F.RIGHT){this.collapse();D=this.items.itemAt(0);if(this.navigateItemsWithTab){if(D){D.focus();}}else{if(this.currentFocus){A=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(A<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(A+1);if(this.currentFocus){this.currentFocus.onLnkFocus();}}}else{this.currentFocus=D;if(D){D.onLnkFocus();}}}}},onKeyUpBuffered:function(A){if(!A.isNavKeyPress()){this.autoSize();}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("");},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this;}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass);}return this;},removeAllItems:function(){this.items.each(function(A){A.preDestroy(true);},this);this.manageClearBtn();return this;},killItems:function(){this.items.each(function(A){A.kill();},this);this.resetStore();this.items.clear();this.manageClearBtn();return this;},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this;}this.usedRecords.each(function(A){this.store.add(A);},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC");}return this;},sortStore:function(){var A=this.store.getSortState();if(A&&A.field){this.store.sort(A.field,A.direction);}return this;},getCaption:function(C){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl);}var B,A=C instanceof Ext.data.Record?C.data:C;if(this.displayFieldTpl){B=this.displayFieldTpl.apply(A);}else{if(this.displayField){B=A[this.displayField];}}return B;},addRecord:function(B){var E=B.data[this.displayField],C=this.getCaption(B),F=B.data[this.valueField],A=this.classField?B.data[this.classField]:"",D=this.styleField?B.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(F,B);this.store.remove(B);}this.addItemBox(F,E,C,A,D);this.fireEvent("additem",this,F,B);},createRecord:function(A){if(!this.recordConstructor){var B=[{name:this.valueField},{name:this.displayField}];if(this.classField){B.push({name:this.classField});}if(this.styleField){B.push({name:this.styleField});}this.recordConstructor=Ext.data.Record.create(B);}return new this.recordConstructor(A);},addItems:function(A){if(Ext.isArray(A)){Ext.each(A,function(B){this.addItem(B);},this);}else{this.addItem(A);}},addNewItem:function(A){this.addItem(A,true);},addItem:function(A,C){var E=A[this.valueField];if(this.disabled){return false;}if(this.preventDuplicates&&this.hasValue(E)){return ;}var B=this.findRecord(this.valueField,E);if(B){this.addRecord(B);return ;}else{if(!this.allowAddNewData){return ;}}if(this.mode==="remote"){this.remoteLookup.push(A);this.doQuery(E,false,false,C);return ;}var D=this.createRecord(A);this.store.add(D);this.addRecord(D);return true;},addItemBox:function(C,E,I,H,D){var F,G=function(K){var J="";switch(typeof K){case"function":J=K.call();break;case"object":for(var L in K){J+=L+":"+K[L]+";";}break;case"string":J=K+";";}return J;},A=Ext.id(null,"sbx-item"),B=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+H,style:G(this.extraItemStyle)+" "+D,caption:I,display:E,value:C,key:A,listeners:{remove:function(J){if(this.fireEvent("beforeremoveitem",this,J.value)===false){return false;}this.items.removeKey(J.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(J.value)){this.store.add(this.usedRecords.get(J.value));this.usedRecords.removeKey(J.value);this.sortStore();if(this.view){this.view.render();}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,J.value,this.findInStore(J.value)]);}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue();},scope:this}});B.render();F={tag:"input",type:"hidden",value:C,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(F,{disabled:"disabled"});}B.hidden=this.el.insertSibling(F,"before");this.items.add(A,B);this.applyEmptyText().autoSize().manageClearBtn().validateValue();},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this;}var A="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(A);}else{this.buttonClear.removeClass(A);}return this;},findInStore:function(B){var A=this.store.find(this.valueField,B);if(A>-1){return this.store.getAt(A);}return false;},getSelectedRecords:function(){var A=[];if(this.removeValuesFromStore){A=this.usedRecords.getRange();}else{var B=[];this.items.each(function(C){B.push(C.value);});Ext.each(B,function(C){A.push(this.findInStore(C));},this);}return A;},findSelectedItem:function(B){var A;this.items.each(function(C){if(C.el.dom===B){A=C;return false;}});return A;},findSelectedRecord:function(B){var A,C=this.findSelectedItem(B);if(C){A=this.findSelectedRecordByValue(C.value);}return A;},findSelectedRecordByValue:function(B){var A;if(this.removeValuesFromStore){this.usedRecords.each(function(C){if(C.get(this.valueField)==B){A=C;return false;}},this);}else{A=this.findInStore(B);}return A;},getValue:function(){var A=[];this.items.each(function(B){A.push(B.value);});return A.join(this.valueDelimiter);},getCount:function(){return this.items.getCount();},getValueEx:function(){var A=[];this.items.each(function(C){var B={};B[this.valueField]=C.value;B[this.displayField]=C.display;if(this.classField){B[this.classField]=C.cls||"";}if(this.styleField){B[this.styleField]=C.style||"";}A.push(B);},this);return A;},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue();}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this);}if(this.mode==="remote"){this.setOriginal=true;}},addValue:function(C){if(Ext.isEmpty(C)){return ;}var A=C;if(!Ext.isArray(C)){C=""+C;A=C.split(this.valueDelimiter);}Ext.each(A,function(E){var D=this.findRecord(this.valueField,E);if(D){this.addRecord(D);}else{if(this.mode==="remote"){this.remoteLookup.push(E);}}},this);if(this.mode==="remote"){var B=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(B,false,true);}},setValue:function(A){if(!this.rendered){this.value=A;return ;}this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(A);},setValueEx:function(A){if(!this.rendered){this.value=A;return ;}this.removeAllItems().resetStore();if(!Ext.isArray(A)){A=[A];}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(A,function(C){var B=this.findRecord(this.valueField,C[this.valueField])||this.createRecord(C);this.addRecord(B);},this);return ;}Ext.each(A,function(B){this.addItem(B);},this);},hasValue:function(B){var A=false;this.items.each(function(C){if(C.value==B){A=true;return false;}},this);return A;},onSelect:function(A,B){if(this.fireEvent("beforeselect",this,A,B)!==false){var C=A.data[this.valueField];if(this.preventDuplicates&&this.hasValue(C)){return ;}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,C,A,this.filteredQueryData)!==false){this.addRecord(A);}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse();}else{this.restrictHeight();}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand);}if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap);}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this);},autoSize:function(){if(!this.rendered){return this;}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el);}var C=this.el,B=C.dom.value,D=document.createElement("div");if(B===""&&this.emptyText&&this.items.getCount()<1){B=this.emptyText;}D.appendChild(document.createTextNode(B));B=D.innerHTML;D=null;B+="&#160;";var A=Math.max(this.metrics.getWidth(B)+24,24);if(typeof this._width!="undefined"){A=Math.min(this._width,A);}this.el.setWidth(A);if(Ext.isIE){this.el.dom.style.top="0";}this.fireEvent("autosize",this,A);return this;},shouldQuery:function(B){if(this.lastQuery){var A=B.match("^"+this.lastQuery);if(!A||this.store.getCount()){return true;}else{return(A[0]!==this.lastQuery);}}return true;},doQuery:function(F,E,B,D){F=Ext.isEmpty(F)?"":F;if(this.queryFilterRe){this.filteredQueryData="";var A=F.match(this.queryFilterRe);if(A&&A.length){this.filteredQueryData=A[0];}F=F.replace(this.queryFilterRe,"");if(!F&&A){return ;}}var C={query:F,forceAll:E,combo:this,cancel:false};if(this.fireEvent("beforequery",C)===false||C.cancel){return false;}F=C.query;E=C.forceAll;if(E===true||(F.length>=this.minChars)||B&&!Ext.isEmpty(F)){if(D||this.forceSameValueQuery||this.shouldQuery(F)){this.lastQuery=F;if(this.mode=="local"){this.selectedIndex=-1;if(E){this.store.clearFilter();}else{this.store.filter(this.displayField,F);}this.onLoad();}else{this.store.baseParams[this.queryParam]=F;this.store.baseParams[this.queryValuesIndicator]=B;this.store.load({params:this.getParams(F)});if(!D){this.expand();}}}else{this.selectedIndex=-1;this.onLoad();}}},onStoreLoad:function(B,A,C){var F=C.params[this.queryParam]||B.baseParams[this.queryParam]||"",G=C.params[this.queryValuesIndicator]||B.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(I){if(this.usedRecords.containsKey(I.get(this.valueField))){this.store.remove(I);}},this);}if(G){var H=F.split(this.queryValuesDelimiter);Ext.each(H,function(I){this.remoteLookup.remove(I);var J=this.findRecord(this.valueField,I);if(J){this.addRecord(J);}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue();}}if(F!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(I){if(typeof I==="object"&&I[this.valueField]===F){this.remoteLookup.remove(I);if(A.length&&A[0].get(this.valueField)===F){this.addRecord(A[0]);return ;}var J=this.createRecord(I);this.store.add(J);this.addRecord(J);this.addedRecords.push(J);(function(){if(this.isExpanded()){this.collapse();}}).defer(10,this);return ;}},this);}var D=[];if(F===""){Ext.each(this.addedRecords,function(I){if(this.preventDuplicates&&this.usedRecords.containsKey(I.get(this.valueField))){return ;}D.push(I);},this);}else{var E=new RegExp(Ext.escapeRe(F)+".*","i");Ext.each(this.addedRecords,function(I){if(this.preventDuplicates&&this.usedRecords.containsKey(I.get(this.valueField))){return ;}if(E.test(I.get(this.displayField))){D.push(I);}},this);}this.store.add(D);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse();}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(A){Ext.apply(this,A);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this);};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this);},onElClick:function(B){var C=this.owner;C.clearCurrentFocus().collapse();if(C.navigateItemsWithTab){this.focus();}else{C.el.dom.focus();var A=this;(function(){this.onLnkFocus();C.currentFocus=this;}).defer(10,this);}},onLnkClick:function(A){if(A){A.stopEvent();}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus();}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus");},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus");},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover");},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this});},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners();},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this);},onRender:function(C,A){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,C,A);var E=this.el;if(E){E.remove();}this.el=E=C.createChild({tag:"li"},C.last());E.addClass("x-superboxselect-item");var D=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var F=this.key;Ext.apply(E,{focus:function(){var G=this.down(D+".x-superboxselect-item-close");if(G){G.focus();}},preDestroy:function(){this.preDestroy();}.createDelegate(this)});this.enableElListeners();E.update(this.caption);var B={tag:D,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(D==="a"){B.href="#";}this.lnk=E.createChild(B);if(!this.disabled){this.enableLnkListeners();}else{this.disableAllListeners();}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap();},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right");},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left");},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var A=this.owner.items.get(0).el.focus();if(A){A.el.focus();}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus();},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true;},moveFocus:function(A){var B=this.el[A=="left"?"prev":"next"]()||this.owner.el;B.focus.defer(100,B);},preDestroy:function(A){if(this.fireEvent("remove",this)===false){return ;}var B=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right");}this.hidden.remove();this.hidden=null;this.destroy();};if(A){B.call(this);}else{this.el.hide({duration:0.2,callback:B,scope:this});}return this;},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy();},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled");}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this);},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled");}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this);},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this);}});Ext.reg("superbox",Ext.ux.form.SuperBoxSelectItem);Ext.onReady(function(){MODx.util.JSONReader=MODx.load({xtype:"modx-json-reader"});MODx.form.Handler=MODx.load({xtype:"modx-form-handler"});MODx.msg=MODx.load({xtype:"modx-msg"});});Ext.form.XCheckbox=Ext.extend(Ext.form.Checkbox,{submitOffValue:0,submitOnValue:1,onRender:function(){this.inputValue=this.submitOnValue;Ext.form.XCheckbox.superclass.onRender.apply(this,arguments);this.hiddenField=this.wrap.insertFirst({tag:"input",type:"hidden"});if(this.tooltip){this.imageEl.set({qtip:this.tooltip});}this.updateHidden();},setValue:function(A){A=this.convertValue(A);this.updateHidden(A);Ext.form.XCheckbox.superclass.setValue.apply(this,arguments);},updateHidden:function(A){A=undefined!==A?A:this.checked;A=this.convertValue(A);if(this.hiddenField){this.hiddenField.dom.value=A?this.submitOnValue:this.submitOffValue;this.hiddenField.dom.name=A?"":this.el.dom.name;}},convertValue:function(A){return(A===true||A==="true"||A===this.submitOnValue||String(A).toLowerCase()==="on");}});Ext.reg("xcheckbox",Ext.form.XCheckbox);