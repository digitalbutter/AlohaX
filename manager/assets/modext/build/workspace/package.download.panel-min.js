MODx.panel.PackageDownload=function(A){A=A||{};Ext.applyIf(A,{id:"modx-panel-package-download",layout:"column",border:false,autoHeight:true,anchor:"97%",autoScroll:true,hideMode:"offsets",items:[{xtype:"modx-tree-package-download",id:"modx-tree-package-download",columnWidth:0.7,anchor:"60%",height:270,autoHeight:false,preventRender:true,hideMode:"offsets"},{columnWidth:0.3,id:"modx-package-info-col",height:270,anchor:"35%",border:false,autoScroll:true,hideMode:"offsets",items:[{id:"modx-panel-package-info",xtype:"panel",style:"padding: 6px",height:270,autoScroll:true,html:""}]}]});MODx.panel.PackageDownload.superclass.constructor.call(this,A);this.loadTemplates();var B=Ext.getCmp("modx-tree-package-download");B.on("click",function(G,E){var D=Ext.getCmp("modx-panel-package-info");var F=D.body;if(G&&G.attributes){var C=G.attributes;if(this.tpls[C.type]){F.hide();this.tpls[C.type].overwrite(F,C.data||{});F.slideIn("l",{stopFx:true,duration:".2"});this.curData=C.data;}}else{F.update("");}},this);};Ext.extend(MODx.panel.PackageDownload,MODx.Panel,{tpls:{},curData:{},showMoreInfo:function(A){if(!this.mi){this.mi=MODx.load({xtype:"modx-window-package-more-info",data:this.curData});}this.mi.showTpl(A,this.curData);},loadTemplates:function(){this.tpls={version:new Ext.XTemplate('<div class="details" style="padding: 1em;">','<tpl for=".">','<div class="modx-pb-details-info">',"<h3>{name}</h3>","<b>"+_("version")+":</b> <span>{version}</span><br />","<b>"+_("release")+":</b> <span>{release}</span><br />","<b>"+_("released_on")+":</b> <span>{releasedon}</span><br />","<b>"+_("supports")+"</b>: <span>{supports}</span><br /><br />",'<a id="pd-version-more-info" href="javascript:;" onclick="Ext.getCmp(\'modx-panel-package-download\').showMoreInfo(this);">'+_("more_info")+"</a><br />","<br /><p>{description}</p>","</div>","</tpl>","</div>"),"package":new Ext.XTemplate('<div class="details" style="padding: 1em;">','<tpl for=".">','<div class="modx-pb-details-info">',"<h3>{name}</h3>","<p>{description}</p></div>","</tpl></div>"),category:new Ext.XTemplate('<div class="details" style="padding: 1em;">','<tpl for=".">','<div class="modx-pb-details-info">',"<h3>{name}</h3>","<p>{description}</p></div>","</tpl></div>"),repository:new Ext.XTemplate('<div class="details" style="padding: 1em;">','<tpl for=".">','<div class="modx-pb-details-info">',"<h3>{name}</h3>","<p>{description}</p></div>","</tpl></div>")};for(var A in this.tpls){if(this.tpls[A]){this.tpls[A].compile();}}}});Ext.reg("modx-panel-package-download",MODx.panel.PackageDownload);MODx.window.PackageMoreInfo=function(A){A=A||{};this.tpl=this.createTpl();Ext.applyIf(A,{title:_("package_information"),anchor:"95%",autoHeight:true,url:MODx.config.connectors_url+"workspace/packages.php",action:"info",autoScroll:true,fields:[{html:'<div id="modx-pmi-content" style="overflow: auto; width: 100%;"></div>',autoScroll:true,height:500}],buttons:[{text:_("ok"),handler:function(){this.hide();},scope:this}]});MODx.window.PackageMoreInfo.superclass.constructor.call(this,A);};Ext.extend(MODx.window.PackageMoreInfo,MODx.Window,{createTpl:function(){this.tpl=new Ext.XTemplate('<div class="details" style="padding: 1em;">','<tpl for=".">','<div class="pmi-content">','<div style="float: right;"><img src="{screenshot}" alt="" width="200" height="134" /></div>',"<h3>{name}</h3>",'<tpl if="author">',"<i>"+_("by")+" {author}</i><br />","</tpl>","<span>"+_("released_on")+": {releasedon}</span><br />","<span>"+_("license")+": {license}</span><br />","<span>"+_("downloads")+": {downloads}</span><br />","<span>"+_("supports")+": {supports}</span><br />","<br /><h4>"+_("description")+"</h4>","<p>{description}</p>",'<tpl if="instructions">',"<br /><h4>"+_("installation_instructions")+"</h4>","<p>{instructions}</p>","</tpl>","</div>","</tpl></div>");this.tpl.compile();return this.tpl;},showTpl:function(A,B){this.show(A,function(){this.tpl.overwrite("modx-pmi-content",B);this.center();},this);}});Ext.reg("modx-window-package-more-info",MODx.window.PackageMoreInfo);MODx.tree.PackageDownload=function(A){A=A||{};Ext.applyIf(A,{baseParams:{action:"getPackages",provider:""},loaderConfig:{preloadChildren:false},rootVisible:false,tbar:[{icon:MODx.config.template_url+"images/restyle/icons/refresh.png",cls:"x-btn-icon",scope:this,tooltip:{text:_("tree_refresh")},handler:this.loadDataFromProvider,hideMode:"offsets"}]});MODx.tree.PackageDownload.superclass.constructor.call(this,A);this.on("render",this.setupMask,this);};Ext.extend(MODx.tree.PackageDownload,MODx.tree.Tree,{setProvider:function(B){var A=this.getLoader().fullMask;if(!A){A=this.setupMask();}A.show();this.provider=B;this.loadDataFromProvider();},loadDataFromProvider:function(){this.getLoader().fullMask.show();MODx.Ajax.request({url:MODx.config.connectors_url+"workspace/providers.php",params:{action:"getPackages",provider:this.provider},listeners:{success:{fn:function(A){this.loadRemoteData(A.object);this.getLoader().fullMask.hide();},scope:this}}});},setupMask:function(){var A=this.getLoader();Ext.apply(A,{fullMask:new Ext.LoadMask(this.getEl(),{msg:_("loading")})});A.fullMask.removeMask=false;A.on({load:function(){this.fullMask.hide();},loadexception:function(){this.fullMask.hide();},beforeload:function(){this.fullMask.show();},scope:A});return A.fullMask;}});Ext.reg("modx-tree-package-download",MODx.tree.PackageDownload);