MODx.grid.AccessResourceGroup=function(A){A=A||{};Ext.applyIf(A,{title:_("ugrg_grid_title"),url:MODx.config.connectors_url+"security/access/index.php",baseParams:{action:"getList",type:A.type||"modAccessResourceGroup"},fields:["id","target","target_name","principal_class","principal","principal_name","authority","policy","policy_name","context_key","menu"],type:"modAccessResourceGroup",paging:true,columns:[{header:_("id"),dataIndex:"id",width:40},{header:_("resource_group_id"),dataIndex:"target",width:40},{header:_("resource_group"),dataIndex:"target_name",width:150},{header:_("user_group_id"),dataIndex:"principal",width:40},{header:_("user_group"),dataIndex:"principal_name",width:150},{header:_("authority"),dataIndex:"authority",width:75},{header:_("policy"),dataIndex:"policy_name",width:175},{header:_("context"),dataIndex:"context_key",width:60}],tbar:this.getToolbar()});MODx.grid.AccessResourceGroup.superclass.constructor.call(this,A);};Ext.extend(MODx.grid.AccessResourceGroup,MODx.grid.Grid,{windows:{},combos:{},createArg:function(A,C){var B=this.menu.record;if(!this.windows.create_arg){this.windows.create_arg=MODx.load({xtype:"modx-window-access-resource-group-create",record:B,listeners:{success:{fn:function(E,D){this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.rg.getValue(),principal_class:"modUserGroup"};this.refresh();},scope:this}}});}else{this.windows.create_arg.setValues(B);}this.windows.create_arg.show(C.target);},editAcl:function(C,B){var A=this.menu.record;if(!this.windows.update_arg){this.windows.update_arg=MODx.load({xtype:"modx-window-access-resource-group-update",acl:A.id,record:A,listeners:{success:{fn:this.refresh,scope:this}}});}else{this.windows.update_arg.setValues(A);}this.windows.update_arg.show(B.target);},removeAcl:function(B,A){MODx.msg.confirm({title:_("ugrg_remove"),text:_("access_confirm_remove"),url:this.config.url,params:{action:"removeAcl",id:this.menu.record.id,type:this.config.type},listeners:{success:{fn:this.refresh,scope:this}}});},clearFilter:function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:"",principal:"",principal_class:"modUserGroup"};this.combos.ug.setValue("");this.combos.rg.setValue("");this.getStore().load();},getToolbar:function(){this.combos.ug=MODx.load({xtype:"modx-combo-usergroup"});this.combos.ug.on("select",function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.ug.getValue()};this.getStore().reload();},this);this.combos.rg=MODx.load({xtype:"modx-combo-resourcegroup"});this.combos.rg.on("select",function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.ug.getValue()};this.getStore().reload();},this);return[_("resource_group")+": ",this.combos.rg,"-",_("user_group")+": ",this.combos.ug,"-",{text:_("clear_filter"),scope:this,handler:this.clearFilter},"->",{text:_("add"),scope:this,handler:this.createArg}];}});Ext.reg("modx-grid-access-resource-group",MODx.grid.AccessResourceGroup);MODx.window.CreateAccessResourceGroup=function(A){A=A||{};this.ident=A.ident||"caccrg"+Ext.id();Ext.applyIf(A,{title:_("ugrg_mutate"),url:MODx.config.connectors_url+"security/access/index.php",baseParams:{action:"addAcl",type:"modAccessResourceGroup"},autoHeight:true,width:350,type:"modAccessResourceGroup",acl:0,fields:[{xtype:"modx-combo-resourcegroup",fieldLabel:_("resource_group"),name:"target",hiddenName:"target",id:"modx-"+this.ident+"-target",anchor:"90%"},{xtype:"modx-combo-usergroup",fieldLabel:_("user_group"),name:"principal",hiddenName:"principal",id:"modx-"+this.ident+"-principal",baseParams:{action:"getList",combo:"1"},anchor:"90%"},{xtype:"textfield",fieldLabel:_("authority"),name:"authority",id:"modx-"+this.ident+"-authority",width:40},{xtype:"modx-combo-policy",fieldLabel:_("policy"),name:"policy",hiddenName:"policy",id:"modx-"+this.ident+"-policy",baseParams:{action:"getList",combo:"1"},anchor:"90%"},{xtype:"modx-combo-context",fieldLabel:_("context"),name:"context_key",hiddenName:"context_key",id:"modx-"+this.ident+"-context-key",anchor:"90%"},{xtype:"hidden",name:"principal_class",id:"modx-"+this.ident+"-principal-class",value:"modUserGroup"}]});MODx.window.CreateAccessResourceGroup.superclass.constructor.call(this,A);};Ext.extend(MODx.window.CreateAccessResourceGroup,MODx.Window);Ext.reg("modx-window-access-resource-group-create",MODx.window.CreateAccessResourceGroup);MODx.window.UpdateAccessResourceGroup=function(A){A=A||{};var B=A.record;this.ident=A.ident||"uaccrg"+Ext.id();Ext.applyIf(A,{title:_("ugrg_mutate"),url:MODx.config.connectors_url+"security/access/index.php",baseParams:{action:"updateAcl",type:"modAccessResourceGroup"},autoHeight:true,width:350,type:"modAccessResourceGroup",acl:0,fields:[{xtype:"modx-combo-resourcegroup",fieldLabel:_("resource_group"),name:"target",hiddenName:"target",id:"modx-"+this.ident+"-target",value:B.target},{xtype:"modx-combo-usergroup",fieldLabel:_("user_group"),name:"principal",hiddenName:"principal",id:"modx-"+this.ident+"-principal",value:B.principal||"",baseParams:{action:"getList",combo:"1"}},{xtype:"textfield",fieldLabel:_("authority"),name:"authority",id:"modx-"+this.ident+"-authority",width:40,value:B.authority},{xtype:"modx-combo-policy",fieldLabel:_("policy"),name:"policy",hiddenName:"policy",id:"modx-"+this.ident+"-policy",value:B.policy||"",baseParams:{action:"getList",combo:"1"}},{xtype:"modx-combo-context",fieldLabel:_("context"),name:"context_key",hiddenName:"context_key",id:"modx-"+this.ident+"-context-key",value:B.context_key||""},{xtype:"hidden",name:"principal_class",id:"modx-"+this.ident+"-principal-class",value:"modUserGroup"},{xtype:"hidden",name:"id",id:"modx-"+this.ident+"-id",value:B.id}]});MODx.window.UpdateAccessResourceGroup.superclass.constructor.call(this,A);};Ext.extend(MODx.window.UpdateAccessResourceGroup,MODx.Window);Ext.reg("modx-window-access-resource-group-update",MODx.window.UpdateAccessResourceGroup);