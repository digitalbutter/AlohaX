MODx.panel.FCProfiles=function(A){A=A||{};Ext.applyIf(A,{id:"modx-panel-fc-profiles",defaults:{collapsible:false,autoHeight:true},items:[{html:"<h2>"+_("form_customization")+"</h2>",border:false,cls:"modx-page-header",id:"modx-fcp-header"},MODx.getPageStructure([{title:_("profiles"),bodyStyle:"padding: 15px;",autoHeight:true,layout:"form",items:[{html:"<p>"+_("form_customization_msg")+"</p>",border:false},{title:"",preventRender:true,xtype:"modx-grid-fc-profile"}]}],{id:"modx-form-customization-tabs"})]});MODx.panel.FCProfiles.superclass.constructor.call(this,A);};Ext.extend(MODx.panel.FCProfiles,MODx.FormPanel);Ext.reg("modx-panel-fc-profiles",MODx.panel.FCProfiles);MODx.grid.FCProfile=function(A){A=A||{};this.sm=new Ext.grid.CheckboxSelectionModel();Ext.applyIf(A,{id:"modx-grid-fc-profile",url:MODx.config.connectors_url+"security/forms/profile.php",fields:["id","name","description","usergroups","active","rank","sets","perm"],paging:true,autosave:true,sm:this.sm,remoteSort:true,columns:[this.sm,{header:_("id"),dataIndex:"id",width:40,sortable:true},{header:_("name"),dataIndex:"name",width:200,sortable:true,editor:{xtype:"textfield"}},{header:_("description"),dataIndex:"description",width:250,sortable:true,editor:{xtype:"textfield"}},{header:_("usergroups"),dataIndex:"usergroups",width:150}],viewConfig:{forceFit:true,enableRowBody:true,scrollOffset:0,autoFill:true,showPreview:true,getRowClass:function(D,B,C){return D.data.active?"grid-row-active":"grid-row-inactive";}},tbar:[{text:_("profile_create"),scope:this,handler:this.createProfile},"-",{text:_("bulk_actions"),menu:[{text:_("selected_activate"),handler:this.activateSelected,scope:this},{text:_("selected_deactivate"),handler:this.deactivateSelected,scope:this},"-",{text:_("selected_remove"),handler:this.removeSelected,scope:this}]},{xtype:"textfield",name:"search",id:"modx-fcp-search",emptyText:_("filter_by_search"),listeners:{change:{fn:this.search,scope:this},render:{fn:function(B){new Ext.KeyMap(B.getEl(),{key:Ext.EventObject.ENTER,fn:function(){this.fireEvent("change",this.getValue());this.blur();return true;},scope:B});},scope:this}}},{xtype:"button",id:"modx-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}]});MODx.grid.FCProfile.superclass.constructor.call(this,A);this.on("render",function(){this.getStore().reload();},this);};Ext.extend(MODx.grid.FCProfile,MODx.grid.Grid,{getMenu:function(){var B=this.getSelectionModel().getSelected();var C=B.data.perm;var A=[];if(this.getSelectionModel().getCount()>1){A.push({text:_("selected_activate"),handler:this.activateSelected});A.push({text:_("selected_deactivate"),handler:this.deactivateSelected});A.push("-");A.push({text:_("selected_remove"),handler:this.removeSelected});}else{if(C.indexOf("pedit")!=-1){A.push({text:_("edit"),handler:this.updateProfile},{text:_("duplicate"),handler:this.duplicateProfile},"-");if(B.data.active){A.push({text:_("deactivate"),handler:this.deactivateProfile});}else{A.push({text:_("activate"),handler:this.activateProfile});}}if(C.indexOf("premove")!=-1){A.push("-",{text:_("remove"),handler:this.confirm.createDelegate(this,["remove","profile_remove_confirm"])});}}if(A.length>0){this.addContextMenuItem(A);}},search:function(D,C,B){var A=C||D;this.getStore().baseParams.search=Ext.isEmpty(A)||Ext.isObject(A)?"":A;this.getBottomToolbar().changePage(1);this.refresh();return true;},clearFilter:function(){this.getStore().baseParams={action:"getList"};Ext.getCmp("modx-fcp-search").reset();this.getBottomToolbar().changePage(1);this.refresh();},createProfile:function(A,B){if(!this.windows.cpro){this.windows.cpro=MODx.load({xtype:"modx-window-fc-profile-create",listeners:{success:{fn:function(C){this.refresh();},scope:this}}});}this.windows.cpro.reset();this.windows.cpro.show(B.target);},updateProfile:function(A,C){var B=this.menu.record;location.href="?a="+MODx.action["security/forms/profile/update"]+"&id="+B.id;},duplicateProfile:function(A,B){MODx.Ajax.request({url:this.config.url,params:{action:"duplicate",id:this.menu.record.id},listeners:{success:{fn:this.refresh,scope:this}}});},activateProfile:function(A,B){MODx.Ajax.request({url:this.config.url,params:{action:"activate",id:this.menu.record.id},listeners:{success:{fn:this.refresh,scope:this}}});},activateSelected:function(){var A=this.getSelectedAsList();if(A===false){return false;}MODx.Ajax.request({url:this.config.url,params:{action:"activateMultiple",profiles:A},listeners:{success:{fn:function(B){this.getSelectionModel().clearSelections(true);this.refresh();},scope:this}}});return true;},deactivateProfile:function(A,B){MODx.Ajax.request({url:this.config.url,params:{action:"deactivate",id:this.menu.record.id},listeners:{success:{fn:this.refresh,scope:this}}});},deactivateSelected:function(){var A=this.getSelectedAsList();if(A===false){return false;}MODx.Ajax.request({url:this.config.url,params:{action:"deactivateMultiple",profiles:A},listeners:{success:{fn:function(B){this.getSelectionModel().clearSelections(true);this.refresh();},scope:this}}});return true;},removeSelected:function(){var A=this.getSelectedAsList();if(A===false){return false;}MODx.msg.confirm({title:_("profile_remove_multiple"),text:_("profile_remove_multiple_confirm"),url:this.config.url,params:{action:"removeMultiple",profiles:A},listeners:{success:{fn:function(B){this.getSelectionModel().clearSelections(true);this.refresh();},scope:this}}});return true;}});Ext.reg("modx-grid-fc-profile",MODx.grid.FCProfile);MODx.window.CreateFCProfile=function(A){A=A||{};Ext.applyIf(A,{title:_("profile_create"),url:MODx.config.connectors_url+"security/forms/profile.php",action:"create",height:150,width:375,fields:[{xtype:"textfield",name:"name",fieldLabel:_("name"),id:"modx-fccp-name",allowBlank:false,anchor:"90%"},{xtype:"textarea",name:"description",fieldLabel:_("description"),id:"modx-fccp-description",anchor:"90%"},{xtype:"xcheckbox",fieldLabel:_("active"),name:"active",id:"modx-fccp-active",inputValue:1,value:1,checked:true,anchor:"90%"}]});MODx.window.CreateFCProfile.superclass.constructor.call(this,A);};Ext.extend(MODx.window.CreateFCProfile,MODx.Window);Ext.reg("modx-window-fc-profile-create",MODx.window.CreateFCProfile);