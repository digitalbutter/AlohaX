Ext.namespace("MODx.panel");MODx.Panel=function(A){A=A||{};Ext.applyIf(A,{cls:"modx-panel",title:""});MODx.Panel.superclass.constructor.call(this,A);this.config=A;};Ext.extend(MODx.Panel,Ext.Panel);Ext.reg("modx-panel",MODx.Panel);MODx.FormPanel=function(A){A=A||{};Ext.applyIf(A,{autoHeight:true,collapsible:true,bodyStyle:"",layout:"anchor",border:false,header:false,method:"POST",cls:"modx-form",ddGroup:"modx-treedrop-dd",allowDrop:true,errorReader:MODx.util.JSONReader,checkDirty:true,useLoadingMask:false,defaults:{collapsible:false,autoHeight:true,border:false}});if(A.items){this.addChangeEvent(A.items);}MODx.FormPanel.superclass.constructor.call(this,A);this.config=A;this.addEvents({setup:true,fieldChange:true,ready:true,beforeSubmit:true,success:true,failure:true,save:true,actionNew:true,actionContinue:true,actionClose:true,postReady:true});this.getForm().addEvents({success:true,failure:true});this.on("ready",this.onReady);if(this.config.useLoadingMask){this.mask=new Ext.LoadMask(this.getEl(),{msg:_("loading")});this.mask.show();}this.fireEvent("setup",A);this.focusFirstField();};Ext.extend(MODx.FormPanel,Ext.FormPanel,{isReady:false,submit:function(B){var A=this.getForm();if(A.isValid()||B.bypassValidCheck){B=B||{};B.headers={"Powered-By":"MODx",modAuth:MODx.siteId};if(this.fireEvent("beforeSubmit",{form:A,options:B,config:this.config})){A.submit({waitMsg:this.config.saveMsg||_("saving"),scope:this,headers:B.headers,clientValidation:(B.bypassValidCheck?false:true),failure:function(D,C){if(this.fireEvent("failure",{form:D,result:C.result,options:B,config:this.config})){MODx.form.Handler.errorExt(C.result,D);}},success:function(D,C){if(this.config.success){Ext.callback(this.config.success,this.config.scope||this,[D,C]);}this.fireEvent("success",{form:D,result:C.result,options:B,config:this.config});this.clearDirty();this.fireEvent("setup",this.config);}});}}else{return false;}return true;},focusFirstField:function(){if(this.getForm().items.getCount()>0){var A=this.findFirstTextField();if(A){A.focus(false,200);}}},findFirstTextField:function(B){B=B||0;var A=this.getForm().items.itemAt(B);if(!A){return false;}if(A.isXType("combo")||A.isXType("checkbox")||A.isXType("radio")||A.isXType("displayfield")||A.isXType("statictextfield")||A.isXType("hidden")){B=B+1;A=this.findFirstTextField(B);}return A;},addChangeEvent:function(A){if(!A){return false;}if(typeof (A)=="object"&&A.items){A=A.items;}for(var D=0;D<A.length;D++){var C=A[D];if(C.items){this.addChangeEvent(C.items);}else{if(C.xtype){if(!C.listeners){C.listeners={};}var B="change";C.enableKeyEvents=true;switch(C.xtype){case"textfield":case"textarea":B="keydown";break;case"checkbox":case"xcheckbox":case"radio":B="check";break;}C.listeners[B]={fn:this.fieldChangeEvent,scope:this};}}}},fieldChangeEvent:function(C,A,B,D){if(!this.isReady){return false;}var D=this.config.onDirtyForm?Ext.getCmp(this.config.onDirtyForm):this.getForm();this.fireEvent("fieldChange",{field:C,nv:A,ov:B,form:D});},markDirty:function(){this.fireEvent("fieldChange");},isDirty:function(){var A=this.config.onDirtyForm?Ext.getCmp(this.config.onDirtyForm):this.getForm();return A.isDirty();},clearDirty:function(){var A=this.config.onDirtyForm?Ext.getCmp(this.config.onDirtyForm):this.getForm();return A.clearDirty();},onReady:function(A){this.isReady=true;if(this.config.allowDrop){this.loadDropZones();}if(this.config.useLoadingMask&&this.mask){this.mask.hide();}this.fireEvent("postReady");},loadDropZones:function(){var A=this.getForm().items;A.each(function(B){if(B.isFormField&&(B.isXType("textfield")||B.isXType("textarea"))&&!B.isXType("combo")){var C=B.getEl();if(C){new MODx.load({xtype:"modx-treedrop",target:B,targetEl:C.dom});}}});},getField:function(B){var A=false;if(typeof B=="string"){A=this.getForm().findField(B);if(!A){A=Ext.getCmp(B);}}return A;},hideField:function(B){if(!Ext.isArray(B)){B=B[B];}var C;for(var A=0;A<B.length;A++){C=this.getField(B[A]);if(!C){return ;}C.hide();var D=C.getEl().up(".x-form-item");if(D){D.setDisplayed(false);}}},showField:function(B){if(!Ext.isArray(B)){B=B[B];}var C;for(var A=0;A<B.length;A++){C=this.getField(B[A]);if(!C){return ;}C.enable();C.show();var D=C.getEl().up(".x-form-item");if(D){D.setDisplayed(true);}}},setLabel:function(D,F,C){if(!Ext.isArray(D)){D=D[D];}if(!Ext.isArray(F)){F=valss[F];}var E,A;for(var B=0;B<D.length;B++){E=this.getField(D[B]);if(!E){return ;}A=String.format("{0}",F[B]);if((E.xtype=="checkbox"||E.xtype=="radio")&&D[B]=="published"){E.setBoxLabel(A);}else{if(E.label){E.label.update(A);}}}}});Ext.reg("modx-formpanel",MODx.FormPanel);MODx.panel.Wizard=function(A){A=A||{};Ext.applyIf(A,{layout:"card",activeItem:0,resizable:true,collapsible:true,maximizable:true,autoHeight:true,width:750,firstPanel:"",lastPanel:"",defaults:{border:false},modal:true,txtFinish:_("finish"),txtNext:_("next"),txtBack:_("back"),bbar:[{id:"pi-btn-bck",itemId:"btn-back",text:A.txtBack||_("back"),handler:this.navHandler.createDelegate(this,[-1]),scope:this,disabled:true},{id:"pi-btn-fwd",itemId:"btn-fwd",text:A.txtNext||_("next"),handler:this.navHandler.createDelegate(this,[1]),scope:this}]});MODx.panel.Wizard.superclass.constructor.call(this,A);this.config=A;this.lastActiveItem=this.config.firstPanel;this._go();};Ext.extend(MODx.panel.Wizard,Ext.Panel,{windows:{},_go:function(){this.getBottomToolbar().items.item(1).setText(this.config.txtNext);this.proceed(this.config.firstPanel);},navHandler:function(B){this.doLayout();var A=this.getLayout().activeItem;if(B==-1){this.proceed(A.config.back||A.config.id);}else{A.submit({scope:this,proceed:this.proceed});}},proceed:function(A){this.doLayout();this.getLayout().setActiveItem(A);if(A==this.config.firstPanel){this.getBottomToolbar().items.item(0).setDisabled(true);this.getBottomToolbar().items.item(1).setText(this.config.txtNext);}else{if(A==this.config.lastPanel){this.getBottomToolbar().items.item(1).setText(this.config.txtFinish);}else{this.getBottomToolbar().items.item(0).setDisabled(false);this.getBottomToolbar().items.item(1).setText(this.config.txtNext);}}}});Ext.reg("modx-panel-wizard",MODx.panel.Wizard);MODx.panel.WizardPanel=function(A){A=A||{};Ext.applyIf(A,{wizard:null,checkDirty:false,bodyStyle:"padding: 3em 3em",hideMode:"offsets"});MODx.panel.WizardPanel.superclass.constructor.call(this,A);};Ext.extend(MODx.panel.WizardPanel,MODx.FormPanel);Ext.reg("modx-wizard-panel",MODx.panel.WizardPanel);MODx.PanelSpacer={html:"<br />",border:false};